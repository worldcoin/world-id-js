import { memo, useEffect, useRef } from 'react'
import QRCodeStyling from 'qr-code-styling'
import styled from 'styled-components'
// import renderToString from 'react-dom/server'
// import { WorldcoinLogomark } from 'assets/logos'

// const logoB64 = window.btoa(renderToString(<WorldcoinLogomark />))

const qrCode = new QRCodeStyling({
  width: 183,
  height: 183,
  type: 'svg',
  // FIXME make base64 converting from asset
  image: `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMWVtIiBoZWlnaHQ9IjFlbSIgdmlld0JveD0iMCAwIDQ2IDQ2IiBmaWxsPSJub25lIg0KICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHBhdGggZD0iTTI2Ljk3OSAxNy45NzQ4QzI3LjA5MTcgMTguMTA2IDI3LjI0OTMgMTguMTkwNiAyNy40MjA5IDE4LjIxMkMyNy41OTI2IDE4LjIzMzUgMjcuNzY2MSAxOC4xOTAzIDI3LjkwNzYgMTguMDkwOUMyOS4yMjMxIDE3LjE2MjMgMzEuNDY3MiAxNS42MTQ3IDMzLjkwNDcgMTQuMDg2NEMzNS43MTM1IDE2LjEyMTYgMzYuOTAxNyAxOC42MzIzIDM3LjMyODggMjEuMzIxNUMzOS4yNDQgMTguNTc0NSA0NC42NjA3IDExLjQ5NDEgMzkuOTk4NSA3Ljk1Mzg5QzM2LjAxMzMgNC45OTQwNSAyNy42NTYxIDEzLjgzNDkgMjYuODI0MyAxNy4zNTU3QzI2Ljc5NzIgMTcuNDYzNyAyNi43OTcyIDE3LjU3NjcgMjYuODI0MSAxNy42ODQ2QzI2Ljg1MTEgMTcuNzkyNiAyNi45MDQzIDE3Ljg5MjMgMjYuOTc5IDE3Ljk3NDhaIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfNzMwMl8xNjExOTUpIiAvPg0KPHBhdGggZD0iTTMwLjIyOSAyMi42NzU5QzMwLjEwMzcgMjIuNzQgMzAgMjIuODM5NiAyOS45MzEgMjIuOTYyM0MyOS44NjE5IDIzLjA4NSAyOS44MzA2IDIzLjIyNTMgMjkuODQxIDIzLjM2NTdDMjkuODUxMyAyMy41MDYxIDI5LjkwMjggMjMuNjQwNCAyOS45ODkgMjMuNzUxNkMzMC4wNzUyIDIzLjg2MjkgMzAuMTkyNCAyMy45NDYzIDMwLjMyNTcgMjMuOTkxNEMzMS44NzM0IDI0LjQ1NTYgMzQuNDg1IDI1LjI0ODggMzcuMTkzMyAyNi4xOTY3QzM2LjczMTQgMjguODg2NiAzNS41MDIxIDMxLjM4NTcgMzMuNjUzMiAzMy4zOTMyQzM2Ljk5OTkgMzMuMTYxMSA0NS45MTgxIDMyLjk4NjkgNDUuODAyIDI3LjE0NDZDNDUuNjI3OSAyMi4xOTIyIDMzLjUxNzcgMjEuMTQ3NiAzMC4yMjkgMjIuNjc1OVoiIGZpbGw9InVybCgjcGFpbnQxX2xpbmVhcl83MzAyXzE2MTE5NSkiIC8+DQo8cGF0aCBkPSJNMjguMTc4NCAyOC42NzI5QzI4LjA3ODggMjguNjI0OSAyNy45Njk3IDI4LjYgMjcuODU5MiAyOC42QzI3Ljc0ODcgMjguNiAyNy42Mzk1IDI4LjYyNDkgMjcuNTQgMjguNjcyOUMyNy4zODYgMjguNzU1NSAyNy4yNjc1IDI4Ljg5MTYgMjcuMjA2OSAyOS4wNTU1QzI3LjE0NjQgMjkuMjE5NCAyNy4xNDc4IDI5LjM5OTggMjcuMjExMSAyOS41NjI3QzI3LjgzMDIgMzEuMDUyMyAyOC44MzYxIDMzLjYwNTkgMjkuNzY0NyAzNi4zMTQzQzI1LjcyMTUgMzguNTAwMyAyMS45NDkyIDM4LjAxNjcgMjEuOTQ5MiAzOC4wMTY3QzI0LjE5MzIgNDAuNDkyOSAyOS44ODA4IDQ3LjM2MDUgMzQuMzg4MiA0My42NDYyQzM4LjE0MTIgNDAuNDE1NSAzMS40Mjg0IDMwLjI3ODUgMjguMTc4NCAyOC42NzI5WiIgZmlsbD0idXJsKCNwYWludDJfbGluZWFyXzczMDJfMTYxMTk1KSIgLz4NCjxwYXRoIGQ9Ik0yMi4yMjAxIDMwLjc4MTZDMjIuMTk2OCAzMC42NzQgMjIuMTQ3NiAzMC41NzM3IDIyLjA3NjggMzAuNDg5NUMyMi4wMDYgMzAuNDA1MiAyMS45MTU4IDMwLjMzOTUgMjEuODEzOCAzMC4yOTc5QzIxLjY1MzcgMzAuMjI4NyAyMS40NzM0IDMwLjIyMjEgMjEuMzA4NiAzMC4yNzk0QzIxLjE0MzggMzAuMzM2NyAyMS4wMDY1IDMwLjQ1MzggMjAuOTI0IDMwLjYwNzVDMjAuMTMwOCAzMi4wMDAzIDE4Ljc3NjYgMzQuMzYwNSAxNy4yMjkgMzYuNzk4QzE0LjcxNDEgMzUuNzQxOCAxMi41NTc3IDMzLjk4MTggMTEuMDE5MSAzMS43Mjk1QzEwLjQ3NzUgMzUuMDM3NSA4LjY1ODk5IDQzLjc2MjMgMTQuMzY1OSA0NC45NjE3QzE5LjI0MDkgNDUuOTA5NiAyMi45NzQ2IDM0LjM0MTEgMjIuMjIwMSAzMC43ODE2WiIgZmlsbD0idXJsKCNwYWludDNfbGluZWFyXzczMDJfMTYxMTk1KSIgLz4NCjxwYXRoIGQ9Ik0xNi44NjE0IDI3LjQ1NEMxNi45MjY2IDI3LjM2NjUgMTYuOTcxIDI3LjI2NTIgMTYuOTkxMiAyNy4xNTc5QzE3LjAxMTMgMjcuMDUwNiAxNy4wMDY2IDI2Ljk0MDIgMTYuOTc3NCAyNi44MzVDMTYuOTM1OSAyNi42NjM3IDE2LjgzMDkgMjYuNTE0NiAxNi42ODM3IDI2LjQxNzZDMTYuNTM2NSAyNi4zMjA3IDE2LjM1OCAyNi4yODMyIDE2LjE4NDMgMjYuMzEyNkMxNC41OTggMjYuNTY0MSAxMS45MDkgMjYuOTcwNCA5LjA0NTg0IDI3LjI3OTlDOC4zMTMyMiAyNC42NTU3IDguMzQ2NzggMjEuODc2NyA5LjE0MjU3IDE5LjI3MDlDNi4yMjE0MiAyMC44OTU5IC0xLjc0ODg3IDI0LjkwMDQgMC44ODIxMDMgMzAuMTIzN0MzLjE2NDg2IDM0LjUxNTEgMTQuNTU5MyAzMC4yNTkxIDE2Ljg2MTQgMjcuNDU0WiIgZmlsbD0idXJsKCNwYWludDRfbGluZWFyXzczMDJfMTYxMTk1KSIgLz4NCjxwYXRoIGQ9Ik0xNi4xMjYyIDIxLjE2NjhDMTYuMjM2NiAyMS4xNjk0IDE2LjM0NTggMjEuMTQ0MiAxNi40NDM4IDIxLjA5MzVDMTYuNTQxOSAyMS4wNDI3IDE2LjYyNTYgMjAuOTY4MiAxNi42ODcyIDIwLjg3NjZDMTYuNzk1NyAyMC43NDE0IDE2Ljg0ODEgMjAuNTY5NyAxNi44MzM3IDIwLjM5NjlDMTYuODE5MyAyMC4yMjQxIDE2LjczOTIgMjAuMDYzNSAxNi42MDk5IDE5Ljk0OEMxNS40MTA0IDE4Ljg2NDcgMTMuNDE3OSAxNy4wMDc1IDExLjQwNiAxNC45NTY5QzEyLjk5NzggMTIuNzQ0NCAxNS4xOTQzIDExLjAzODIgMTcuNzMxOSAxMC4wNDMyQzE0LjYzNjYgOC43ODU3NyA2LjUzMDkyIDUuMDMyNzcgNC4wNzQwNiAxMC4zMzM0QzIuMDYyMTQgMTQuODYwMiAxMi41MDg2IDIxLjEwODggMTYuMTI2MiAyMS4xNjY4WiIgZmlsbD0idXJsKCNwYWludDVfbGluZWFyXzczMDJfMTYxMTk1KSIgLz4NCjxwYXRoIGQ9Ik0yMS4xNTYgMTYuOTQ5NUMyMS4zMzI5IDE2Ljk0NTMgMjEuNTAxOSAxNi44NzU3IDIxLjYzMDUgMTYuNzU0M0MyMS43NTkxIDE2LjYzMjggMjEuODM4MiAxNi40NjggMjEuODUyNSAxNi4yOTE3QzIxLjk0OTIgMTQuNzA1NCAyMi4xNjIgMTEuOTc3NyAyMi41MTAyIDkuMTMzOTRDMjUuMjI5MSA4Ljk5Nzg3IDI3LjkyOTQgOS42NDk0NSAzMC4yODcgMTEuMDEwNEMyOS4zNTg1IDcuNzk5MTEgMjcuMjQ5OCAtMC44Njc2MTEgMjEuNTgxNiAwLjUyNTI1NEMxNi43ODQgMS43NjMzNiAxOC4zNzAzIDEzLjgxNTUgMjAuNTk1IDE2LjY5OEMyMC42NTk4IDE2Ljc4MzcgMjAuNzQ1MiAxNi44NTE3IDIwLjg0MzMgMTYuODk1N0MyMC45NDEzIDE2LjkzOTcgMjEuMDQ4OSAxNi45NTgyIDIxLjE1NiAxNi45NDk1WiIgZmlsbD0idXJsKCNwYWludDZfbGluZWFyXzczMDJfMTYxMTk1KSIgLz4NCjxkZWZzPg0KICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfNzMwMl8xNjExOTUiIHgxPSIwLjM1NzQyMiIgeTE9IjIyLjY5NTciIHgyPSI0NS44MDMyIiB5Mj0iMjIuNjk1NyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGRjY4NDgiIC8+DQogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNDk0MEUwIiAvPg0KICA8L2xpbmVhckdyYWRpZW50Pg0KICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MV9saW5lYXJfNzMwMl8xNjExOTUiIHgxPSIwLjM1NzQyMiIgeTE9IjIyLjY5NTciIHgyPSI0NS44MDMyIiB5Mj0iMjIuNjk1NyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGRjY4NDgiIC8+DQogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNDk0MEUwIiAvPg0KICA8L2xpbmVhckdyYWRpZW50Pg0KICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50Ml9saW5lYXJfNzMwMl8xNjExOTUiIHgxPSIwLjM1NzQyMiIgeTE9IjIyLjY5NTciIHgyPSI0NS44MDMyIiB5Mj0iMjIuNjk1NyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGRjY4NDgiIC8+DQogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNDk0MEUwIiAvPg0KICA8L2xpbmVhckdyYWRpZW50Pg0KICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50M19saW5lYXJfNzMwMl8xNjExOTUiIHgxPSIwLjM1NzQyMiIgeTE9IjIyLjY5NTciIHgyPSI0NS44MDMyIiB5Mj0iMjIuNjk1NyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGRjY4NDgiIC8+DQogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNDk0MEUwIiAvPg0KICA8L2xpbmVhckdyYWRpZW50Pg0KICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50NF9saW5lYXJfNzMwMl8xNjExOTUiIHgxPSIwLjM1NzQyMiIgeTE9IjIyLjY5NTciIHgyPSI0NS44MDMyIiB5Mj0iMjIuNjk1NyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGRjY4NDgiIC8+DQogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNDk0MEUwIiAvPg0KICA8L2xpbmVhckdyYWRpZW50Pg0KICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50NV9saW5lYXJfNzMwMl8xNjExOTUiIHgxPSIwLjM1NzQyMiIgeTE9IjIyLjY5NTciIHgyPSI0NS44MDMyIiB5Mj0iMjIuNjk1NyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGRjY4NDgiIC8+DQogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNDk0MEUwIiAvPg0KICA8L2xpbmVhckdyYWRpZW50Pg0KICA8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50Nl9saW5lYXJfNzMwMl8xNjExOTUiIHgxPSIwLjM1NzQyMiIgeTE9IjIyLjY5NTciIHgyPSI0NS44MDMyIiB5Mj0iMjIuNjk1NyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPg0KICAgIDxzdG9wIHN0b3AtY29sb3I9IiNGRjY4NDgiIC8+DQogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNDk0MEUwIiAvPg0KICA8L2xpbmVhckdyYWRpZW50Pg0KPC9kZWZzPg0KPC9zdmc+`,
  cornersSquareOptions: {
    type: 'extra-rounded',
  },
  cornersDotOptions: {
    type: 'dot',
  },
  dotsOptions: {
    color: 'var(--qr-color)',
    type: 'extra-rounded',
  },
  backgroundOptions: {
    color: 'transparent',
  },
  imageOptions: {
    margin: 4,
    hideBackgroundDots: true,
  },
})

const SQRContainer = styled.div`
  position: relative;
  z-index: 0;
  display: flex;
  width: 198px;
  height: 198px;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--qr-container-color);
  border-radius: 2px;
  &::before,
  &::after {
    content: '';
    display: block;
    position: absolute;
    z-index: -1;
    background: var(--bg);
  }
  &::before {
    top: 24px;
    bottom: 24px;
    left: -1px;
    right: -1px;
  }
  &::after {
    top: -1px;
    bottom: -1px;
    left: 24px;
    right: 24px;
  }
  & > * {
    position: relative;
  }
`

interface QRRenderInterface {
  data: string
}

export const QRRender = memo(function QRRender({ data }: QRRenderInterface): JSX.Element {
  const qrContainRef = useRef<HTMLDivElement>(null)
  useEffect(() => {
    qrContainRef?.current && qrCode.append(qrContainRef.current)
  }, [])

  useEffect(() => {
    qrCode.update({ data })
  }, [data])

  return <SQRContainer ref={qrContainRef} />
})
